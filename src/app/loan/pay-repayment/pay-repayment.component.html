
<p-toast></p-toast>

<div *ngIf="loading">
  <div class="socket">
    <div class="gel center-gel">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c1 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c2 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c3 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c4 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c5 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c6 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c7 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c8 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c9 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c10 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c11 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c12 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c13 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c14 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c15 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c16 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c17 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c18 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c19 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c20 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c21 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c22 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c23 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c24 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c25 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c26 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c28 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c29 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c30 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c31 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c32 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c33 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c34 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c35 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c36 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c37 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
  </div>
</div>

<div *ngIf="!loading" class="master-container">
  <div class="card repayment">
    <div class="card-header">
      <h2 class="title">Thanh toán khoản vay</h2>
      <p class="subtitle">Vui lòng chọn tài khoản và nhập số tiền thanh toán</p>
    </div>

    <div class="content">
      <div class="summary">
        <div class="summary-item">
          <span class="label">Số tiền gốc:</span>
          <span class="value">{{ repayment.principal | currency:'VND':'symbol-narrow' :'1.0-20' }}</span>
        </div>
        <div class="summary-item">
          <span class="label">Số tiền lãi:</span>
          <span class="value">{{ repayment.interest | currency:'VND':'symbol-narrow' :'1.0-20' }}</span>
        </div>
        <div class="summary-item total">
          <span class="label">Tổng số tiền:</span>
          <span class="value">{{ calculateTotalAmount() | currency:'VND':'symbol-narrow' :'1.0-20' }}</span>
        </div>
        <div class="summary-item">
          <span class="label">Đã thanh toán:</span>
          <span class="value">{{ repayment.paidAmount | currency:'VND':'symbol-narrow' :'1.0-20' }}</span>
        </div>
        <div class="summary-item remaining">
          <span class="label">Số tiền còn lại:</span>
          <span class="value">{{ calculateRemainingAmount() | currency:'VND':'symbol-narrow' :'1.0-20' }}</span>
        </div>
      </div>

      <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()" class="form">
        <div class="field">
          <label for="accountNumber">Chọn tài khoản thanh toán</label>
          <p-dropdown
            id="accountNumber"
            formControlName="accountNumber"
            [options]="accounts"
            optionLabel="accountNumber"
            placeholder="Chọn tài khoản"
            [showClear]="true"
            class="w-full"
          ></p-dropdown>
          <small *ngIf="paymentForm.get('accountNumber')?.invalid && paymentForm.get('accountNumber')?.touched">
            Vui lòng chọn tài khoản thanh toán
          </small>
        </div>

        <div class="field">
          <label for="amount">Số tiền thanh toán</label>
          <p-inputNumber
            id="amount"
            [minFractionDigits]="0"
            [maxFractionDigits]="10"
            [useGrouping]="false"
            [showButtons]="false"
            [min]="0"
            [mode]="'decimal'"
            locale="vi-VN"
            formControlName="amount"
            class="w-full"
            placeholder="Nhập số tiền"
          ></p-inputNumber>
          <small *ngIf="paymentForm.get('amount')?.invalid && paymentForm.get('amount')?.touched">
            Vui lòng nhập số tiền hợp lệ
          </small>
        </div>

        <button pButton type="submit" label="Thanh toán" icon="pi pi-money-bill"
          [loading]="loading" [disabled]="paymentForm.invalid" class="action-btn">
        </button>
      </form>
    </div>
  </div>

  <p-dialog
    [(visible)]="showOtpDialog"
    [modal]="true"
    [style]="{width: '450px'}"
    header="Xác nhận OTP"
    [draggable]="false"
    [resizable]="false"
    contentStyleClass="otp-dialog-content"
  >
    <div class="otp-content">
      <form [formGroup]="otpForm" (ngSubmit)="confirmPayment()" class="form">
        <div class="field">
          <label for="otpCode">Vui lòng nhập mã OTP đã được gửi đến email của bạn</label>
          <input
            id="otpCode"
            type="text"
            pInputText
            formControlName="otpCode"
            maxlength="6"
            class="w-full"
          >
        </div>
        <button pButton type="submit" label="Xác nhận thanh toán" icon="pi pi-check"
          [loading]="loading" [disabled]="otpForm.invalid" class="action-btn">
        </button>
      </form>
    </div>
  </p-dialog>
</div>
