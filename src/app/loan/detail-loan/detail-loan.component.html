<div class="loan-detail-container">
  <div *ngIf="loading">
    <div class="socket">
      <div class="gel center-gel">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c1 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c2 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c3 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c4 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c5 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c6 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c7 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c8 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c9 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c10 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c11 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c12 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c13 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c14 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c15 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c16 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c17 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c18 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c19 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c20 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c21 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c22 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c23 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c24 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c25 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c26 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c28 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c29 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c30 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c31 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c32 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c33 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c34 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c35 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c36 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
      <div class="gel c37 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
      </div>
    </div>
  </div>

  <div class="error-banner" *ngIf="error">
    <i class="pi pi-exclamation-triangle"></i>
    <span>{{ error }}</span>
  </div>

  <div class="loan-detail-content" *ngIf="loanDetail && !loading">
    <div class="loan-header">
      <div class="header-content">
        <h1>Chi tiết khoản vay</h1>
        <p class="subtitle">Xem thông tin và trạng thái khoản vay của bạn</p>
      </div>
      <div class="loan-status" [ngClass]="loanDetail.status?.toLowerCase()">
        <i class="pi" [ngClass]="{
          'pi-check-circle': loanDetail.status === 'APPROVED',
          'pi-clock': loanDetail.status === 'PENDING',
          'pi-times-circle': loanDetail.status === 'REJECTED'
        }"></i>
        <span>{{ loanDetail.status }}</span>
      </div>
    </div>

    <div class="content-grid">
      <div class="info-card">
        <div class="card-header">
          <i class="pi pi-info-circle"></i>
          <h2>Thông tin</h2>
        </div>
        <div class="info-grid">
          <div class="info-item">
            <i class="pi pi-id-card"></i>
            <div class="info-content">
              <label>Mã khoản vay</label>
              <span>{{ loanDetail.loanId }}</span>
            </div>
          </div>
          <div class="info-item">
            <i class="pi pi-credit-card"></i>
            <div class="info-content">
              <label>Số tài khoản</label>
              <span>{{ loanDetail.accountNumber }}</span>
            </div>
          </div>
          <div class="info-item">
            <i class="pi pi-dollar"></i>
            <div class="info-content">
              <label>Số tiền vay</label>
              <span>{{ formatCurrency(loanDetail.amount) }}</span>
            </div>
          </div>
          <div class="info-item">
            <i class="pi pi-percentage"></i>
            <div class="info-content">
              <label>Lãi suất</label>
              <span>{{ loanDetail.interestRate }}%</span>
            </div>
          </div>
          <div class="info-item">
            <i class="pi pi-clock"></i>
            <div class="info-content">
              <label>Kỳ hạn (tháng)</label>
              <span>{{ loanDetail.termMonths }}</span>
            </div>
          </div>
          <div class="info-item">
            <i class="pi pi-wallet"></i>
            <div class="info-content">
              <label>Thu nhập</label>
              <span>{{ formatCurrency(loanDetail.declaredIncome) }}</span>
            </div>
          </div>
          <div class="info-item">
            <i class="pi pi-calendar"></i>
            <div class="info-content">
              <label>Ngày tạo</label>
              <span>{{ formatDate(loanDetail.createdAt) }}</span>
            </div>
          </div>
          <div class="info-item" *ngIf="loanDetail.approvedAt">
            <i class="pi pi-calendar-check"></i>
            <div class="info-content">
              <label>Ngày duyệt</label>
              <span>{{ formatDate(loanDetail.approvedAt) }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="repayment-card" *ngIf="loanDetail.repayments?.length">
        <div class="card-header">
          <i class="pi pi-list"></i>
          <h2>Lịch trả nợ</h2>
        </div>
        <div class="repayment-table-wrapper">
          <p-table 
            [value]="loanDetail.repayments  ?? []"
            styleClass="p-datatable-gridlines"
            [tableStyle]="{'min-width': '50rem'}">
            <ng-template pTemplate="header">
              <tr>
                <th>Ngày đến hạn</th>
                <th>Trạng thái</th>
                <th>Gốc</th>
                <th>Lãi</th>
                <th>Số tiền đã trả</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-repayment>
              <tr>
                <td>{{ formatDate(repayment.dueDate) }}</td>
                <td>
                  <span class="status-badge" [ngClass]="repayment.status?.toLowerCase()">
                    {{ repayment.status }}
                  </span>
                </td>
                <td>{{ formatCurrency(repayment.principal) }}</td>
                <td>{{ formatCurrency(repayment.interest) }}</td>
                <td>{{ formatCurrency(repayment.paidAmount) }}</td>
               
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>

      <div class="rejection-card" *ngIf="loanDetail.rejectionReasons?.length">
        <div class="card-header">
          <i class="pi pi-times-circle"></i>
          <h2>Lý do từ chối</h2>
        </div>
        <div class="rejection-list">
          <div class="rejection-item" *ngFor="let reason of loanDetail.rejectionReasons">
            <i class="pi pi-exclamation-circle"></i>
            <span>{{ reason.reason }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
