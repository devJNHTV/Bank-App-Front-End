<div *ngIf="loading">
  <div class="socket">
    <div class="gel center-gel">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c1 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c2 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c3 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c4 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c5 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c6 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c7 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c8 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c9 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c10 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c11 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c12 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c13 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c14 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c15 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c16 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c17 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c18 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c19 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c20 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c21 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c22 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c23 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c24 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c25 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c26 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c28 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c29 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c30 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c31 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c32 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c33 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c34 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c35 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c36 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
    <div class="gel c37 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
  </div>
</div>

<div *ngIf="!loading" class="loan-application-container">
  <div class="dashboard-header">
    <h1 class="dashboard-title">Đăng Ký Khoản Vay Mới</h1>
  </div>
  <div class="apply-loan-wrapper">
    
    <div class="loan-conditions">
      <h3 class="section-subtitle">Điều kiện vay</h3>
      <div class="table-wrapper">
        <table class="condition-table">
          <thead>
            <tr>
              <th>Số tiền vay (VND)</th>
              <th>Thời hạn tối đa (tháng)</th>
              <th>Lãi suất (%)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>≤ 50.000.000</td>
              <td>60</td>
              <td>5,0 – 10,0 + điều chỉnh</td>
            </tr>
            <tr>
              <td>50.000.001 – 200.000.000</td>
              <td>120</td>
              <td>10,0 – 15,0 + điều chỉnh</td>
            </tr>
            <tr>
              <td>> 200.000.000</td>
              <td>240</td>
              <td>15,0 – 20,0 + điều chỉnh</td>
            </tr>
          </tbody>
        </table>
      </div>
      <p class="footnote">
        <small>
          * Lãi suất chính xác sẽ được tính tự động dựa vào số tiền và thời hạn vay.
        </small>
      </p>
      <div class="income-note">
        <p><strong>Lưu ý:</strong> Đối với các trường hợp trễ thanh toán, tổng số tiền phải trả của kỳ hạn bị trễ sẽ cộng dồn vào kỳ hạn tiếp theo và kỳ hạn tiếp theo bị phạt + 1.5% số tiền lãi kỳ bị trẽ.</p>
        <p><strong>Trong trường hợp kỳ vay cuối cùng bị trễ, khách hàng sẽ được tạo lại kỳ vay cuối cùng với số tiền lãi phạt tương tự.</strong></p>
      </div>
    </div>

    <form [formGroup]="loanForm" (ngSubmit)="onSubmit()" class="apply-loan-form">
      <div class="income-note">
        <p><strong>Lưu ý:</strong> Thu nhập tối thiểu để đăng ký là <strong>{{ 5_000_000 | number:'1.0-0' }} VND</strong></p>
      </div>
      <div class="form-grid">
        <!-- Thu nhập -->
        <div class="form-field">
          <label for="declaredIncome">Tổng thu nhập cá nhân (VND/tháng)</label>
          <p-inputNumber
            id="declaredIncome"
            formControlName="declaredIncome"
            placeholder="Nhập thu nhập"
            [style]="{ width: '100%' }"
            [inputStyle]="{ width: '100%' }"
            [class.invalid]="loanForm.get('declaredIncome')?.touched && loanForm.get('declaredIncome')?.invalid"
            mode="currency"
            currency="VND"
            locale="vi-VN">
          </p-inputNumber>
          <small class="p-error" *ngIf="loanForm.get('declaredIncome')?.touched && loanForm.get('declaredIncome')?.hasError('required')">
            Vui lòng nhập thu nhập.
          </small>
          <small class="p-error" *ngIf="loanForm.get('declaredIncome')?.touched && loanForm.get('declaredIncome')?.hasError('min')">
            Thu nhập tối thiểu là {{ 5_000_000 | number:'1.0-0' }} VND.
          </small>
        </div>
        <!-- Số tiền vay -->
        <div class="form-field">
          <label for="amount">Số tiền vay (VND)</label>
          <p-inputNumber
            id="amount"
            formControlName="amount"
            placeholder="Nhập số tiền"
            [style]="{ width: '100%' }"
            [inputStyle]="{ width: '100%' }"
            [class.invalid]="loanForm.get('amount')?.touched && loanForm.get('amount')?.invalid"
            mode="currency"
            currency="VND"
            locale="vi-VN">
          </p-inputNumber>
          <small class="p-error" *ngIf="loanForm.get('amount')?.touched && loanForm.get('amount')?.hasError('required')">
            Vui lòng nhập số tiền.
          </small>
          <small class="p-error" *ngIf="loanForm.get('amount')?.touched && loanForm.get('amount')?.hasError('min')">
            Số tiền tối thiểu là 1.000.000 VND.
          </small>
        </div>
        <!-- Thời gian vay -->
        <div class="form-field">
          <label for="termMonths">Thời gian vay (tháng)</label>
          <p-inputNumber
            id="termMonths"
            formControlName="termMonths"
            placeholder="Nhập số tháng"
            [min]="1"
            [style]="{ width: '100%' }"
            [inputStyle]="{ width: '100%' }"
            [class.invalid]="loanForm.get('termMonths')?.touched && loanForm.get('termMonths')?.invalid">
          </p-inputNumber>
          <small class="p-error" *ngIf="loanForm.get('termMonths')?.touched && loanForm.get('termMonths')?.hasError('required')">
            Vui lòng nhập thời gian vay.
          </small>
          <small class="p-error" *ngIf="loanForm.get('termMonths')?.touched && loanForm.get('termMonths')?.hasError('min')">
            Thời gian tối thiểu là 1 tháng.
          </small>
          <small class="p-error" *ngIf="loanForm.get('termMonths')?.touched && loanForm.get('termMonths')?.hasError('termTooLong')">
            Thời gian vay tối đa dựa trên số tiền:
            <strong>
              {{ loanForm.get('termMonths')?.getError('termTooLong')?.maxTerm }} tháng
            </strong>.
          </small>
        </div>
        <!-- Lãi suất -->
        <div class="form-field">
          <label for="interestRate">Lãi suất tự tính (%/năm)</label>
          <p-inputNumber
            id="interestRate"
            formControlName="interestRate"
            placeholder="Lãi suất"
            [style]="{ width: '100%' }"
            [inputStyle]="{ width: '100%' }"
            [disabled]="true"
            mode="decimal"
            suffix="%">
          </p-inputNumber>
          <small class="note-rate">
            <i>(Lãi suất sẽ được tính tự động)</i>
          </small>
        </div>
      </div>
      <!-- Tài khoản -->
      <div class="form-field">
        <label for="accountNumber">Tài khoản giải ngân</label>
        <p-dropdown
          id="accountNumber"
          formControlName="accountNumber"
          [options]="accounts"
          optionLabel="accountNumber"
          optionValue="accountNumber"
          placeholder="Chọn tài khoản"
          [class.invalid]="loanForm.get('accountNumber')?.touched && loanForm.get('accountNumber')?.invalid">
        </p-dropdown>
        <small class="p-error" *ngIf="loanForm.get('accountNumber')?.touched && loanForm.get('accountNumber')?.hasError('required')">
          Vui lòng chọn tài khoản.
        </small>
      </div>
      <!-- Nút submit -->
      <div class="form-actions">
        <p-button
          type="submit"
          label="Gửi Đăng Ký"
          icon="pi pi-check"
          styleClass="p-button-raised modern-button primary-btn"
          [disabled]="loanForm.invalid || loading"
          [loading]="loading">
        </p-button>
      </div>
    </form>
  </div>
</div>
